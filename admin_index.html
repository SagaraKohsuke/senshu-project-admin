<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœå¤•é£Ÿäºˆç´„ã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†ç”»é¢</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <style>
    /* Android font scaling fix */
    *, *::before, *::after {
      -webkit-text-size-adjust: 100% !important;
      -moz-text-size-adjust: 100% !important;
      -ms-text-size-adjust: 100% !important;
      text-size-adjust: 100% !important;
    }
    
    body { 
      font-family: 'Helvetica Neue', Arial, sans-serif; 
      margin: 0; 
      padding: 10px; 
      background-color: #f5f5f5;
      -webkit-text-size-adjust: 100% !important;
      -moz-text-size-adjust: 100% !important;
      -ms-text-size-adjust: 100% !important;
      text-size-adjust: 100% !important;
    }
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background-color: white; 
      padding: 15px; 
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      -webkit-text-size-adjust: 100% !important;
      -moz-text-size-adjust: 100% !important;
      -ms-text-size-adjust: 100% !important;
      text-size-adjust: 100% !important;
    }
    h1 { color: #333; margin-top: 0; font-size: 1.5rem; }
    h2.month-header { color: #2c3e50; text-align: center; margin: 20px 0 15px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    select, input { 
      width: 100%; 
      padding: 12px; 
      border: 1px solid #ddd; 
      border-radius: 4px; 
      background-color: white; 
      font-size: 16px !important; 
      box-sizing: border-box;
      -webkit-text-size-adjust: 100% !important;
      -moz-text-size-adjust: 100% !important;
      -ms-text-size-adjust: 100% !important;
      text-size-adjust: 100% !important;
    }
    .loading { display: flex; justify-content: center; padding: 20px; color: #666; }
    
    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« - ã‚¹ãƒãƒ›æœ€é©åŒ– */
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 20px; }
    .weekday-header { text-align: center; font-weight: bold; padding: 8px 4px; background-color: #f0f0f0; border-radius: 4px; font-size: 0.9rem; }
    .calendar-cell { min-height: 100px; border: 1px solid #ddd; border-radius: 4px; padding: 4px; background-color: white; overflow: hidden; cursor: pointer; transition: all 0.2s ease; }
    .calendar-cell:hover { background-color: #f8f9fa; }
    .calendar-cell.today { background-color: #fff8e1; border-color: #ffca28; }
    .calendar-cell.selected { background-color: #e3f2fd; border-color: #2196f3; border-width: 2px; }
    .empty-cell { background-color: #f9f9f9; cursor: default; }
    .empty-cell:hover { background-color: #f9f9f9; }
    .date-header { font-weight: bold; text-align: right; border-bottom: 1px solid #eee; padding-bottom: 3px; margin-bottom: 5px; font-size: 0.9rem; }
    .meal-section { font-size: 0.75rem; }
    .meal-item { margin-bottom: 4px; }
    .meal-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
    .meal-count { display: inline-block; background-color: #4285f4; color: white; padding: 1px 6px; border-radius: 8px; font-size: 0.7rem; font-weight: bold; }
    .menu-display { font-size: 0.7rem !important; color: #555; padding-left: 3px; margin-bottom: 3px; line-height: 1.1; }
    .recruitment-control { margin-top: 4px; text-align: center; }
    .stop-button { padding: 3px 6px; font-size: 0.65rem; border: none; border-radius: 3px; cursor: pointer; background-color: #dc3545; color: white; }
    .stop-button:hover { background-color: #c82333; }
    .stop-button.stopped { background-color: #28a745; }
    .stop-button.stopped:hover { background-color: #218838; }
    .unavailable { font-size: 0.7rem; color: #999; }
    hr { margin: 6px 0; border: none; border-top: 1px dotted #ddd; }
    
    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ã‚¨ãƒªã‚¢ */
    .menu-edit-area { 
      background-color: #f8f9fa; 
      border: 1px solid #dee2e6; 
      border-radius: 8px; 
      padding: 20px; 
      margin-bottom: 20px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .menu-edit-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 15px; 
      border-bottom: 2px solid #dee2e6; 
      padding-bottom: 10px; 
    }
    .menu-edit-date { 
      font-size: 1.2rem; 
      font-weight: bold; 
      color: #2c3e50; 
    }
    .menu-edit-close { 
      background: none; 
      border: none; 
      font-size: 1.5rem; 
      cursor: pointer; 
      color: #6c757d; 
      padding: 5px; 
    }
    .menu-edit-close:hover { color: #dc3545; }
    .meal-edit-section { 
      margin-bottom: 20px; 
      padding: 15px; 
      background-color: white; 
      border-radius: 6px; 
      border-left: 4px solid #4285f4; 
    }
    .meal-edit-section.dinner { border-left-color: #e74c3c; }
    .meal-edit-title { 
      font-size: 1.1rem; 
      font-weight: bold; 
      margin-bottom: 10px; 
      color: #2c3e50; 
    }
    .current-menu { 
      margin-bottom: 15px; 
      padding: 10px; 
      background-color: #e9ecef; 
      border-radius: 4px; 
    }
    .current-menu-label { 
      font-weight: bold; 
      margin-bottom: 5px; 
      color: #495057; 
    }
    .current-menu-text { 
      color: #6c757d; 
      font-style: italic; 
    }
    .menu-input-section { 
      display: flex; 
      gap: 10px; 
      align-items: flex-end;
      flex-wrap: wrap;
    }
    .autocomplete-container {
      position: relative;
      flex: 2;
      min-width: 200px;
    }
    .calorie-input-container {
      flex: 1;
      min-width: 120px;
      display: flex;
      flex-direction: column;
    }
    .calorie-input-container label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #495057;
    }
    .calorie-input-container input {
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
      width: 70px;
    }
    .calorie-input-container .calorie-unit {
      display: inline-block;
      margin-left: 5px;
      color: #6c757d;
      font-size: 14px;
      line-height: 36px;
    }
    .menu-calorie {
      color: #6c757d;
      font-size: 0.9em;
    }
    .calorie-info {
      font-size: 0.8em;
      color: #6c757d;
      margin-top: 2px;
    }
    .current-calorie {
      color: #6c757d;
      font-size: 0.9em;
    }
    .autocomplete-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ced4da;
      border-top: none;
      border-radius: 0 0 4px 4px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .autocomplete-suggestion {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #f8f9fa;
    }
    .autocomplete-suggestion:hover,
    .autocomplete-suggestion.selected {
      background-color: #e9ecef;
    }
    .autocomplete-suggestion:last-child {
      border-bottom: none;
    }
    .autocomplete-container label { 
      display: block; 
      margin-bottom: 5px; 
      font-weight: bold; 
      color: #495057; 
    }
    .autocomplete-container input { 
      width: 100%; 
      padding: 8px 12px; 
      border: 1px solid #ced4da; 
      border-radius: 4px; 
      font-size: 14px; 
    }
    .menu-update-btn { 
      background-color: #28a745; 
      color: white; 
      border: none; 
      border-radius: 4px; 
      padding: 8px 20px; 
      font-size: 14px; 
      cursor: pointer; 
      white-space: nowrap; 
      height: fit-content; 
    }
    .menu-update-btn:hover { background-color: #218838; }
    .menu-update-btn:disabled { background-color: #6c757d; cursor: not-allowed; }
    .recruitment-toggle-section { 
      text-align: center; 
      padding-top: 10px; 
      border-top: 1px solid #dee2e6; 
      margin-top: 10px; 
    }
    .recruitment-toggle-btn { 
      padding: 8px 16px; 
      font-size: 14px; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      background-color: #dc3545; 
      color: white; 
    }
    .recruitment-toggle-btn:hover { background-color: #c82333; }
    .recruitment-toggle-btn.stopped { background-color: #28a745; }
    .recruitment-toggle-btn.stopped:hover { background-color: #218838; }
    .meal-unavailable { 
      text-align: center; 
      color: #6c757d; 
      font-style: italic; 
      padding: 20px; 
    }
    
    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - ã‚¹ãƒãƒ›å¯¾å¿œ */
    .month-navigation { display: flex; justify-content: space-between; align-items: center; margin: 10px 0 20px; flex-wrap: wrap; gap: 10px; }
    .month-navigation button { 
      background-color: #4285f4; 
      color: white; 
      border: none; 
      border-radius: 4px; 
      padding: 10px 15px; 
      cursor: pointer; 
      font-size: 14px !important; 
      min-width: 120px;
      -webkit-text-size-adjust: 100% !important;
      -moz-text-size-adjust: 100% !important;
      -ms-text-size-adjust: 100% !important;
      text-size-adjust: 100% !important;
    }
    .month-navigation button:disabled { background-color: #b0bec5; cursor: not-allowed; }
    .month-navigation h3 { margin: 0 10px; font-size: 1.1rem; }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼ - ã‚¹ãƒãƒ›å¯¾å¿œ */
    .calendar-container { margin-top: 20px; }
    .admin-header { background-color: #2c3e50; color: white; padding: 15px; margin: -15px -15px 20px -15px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
    .admin-header h1 { color: white; margin: 0; }
    .admin-badge { background-color: #e74c3c; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
    
    /* ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - ã‚¹ãƒãƒ›å¯¾å¿œ */
    .summary-section { background-color: #ecf0f1; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    .summary-title { font-weight: bold; margin-bottom: 15px; text-align: center; font-size: 1.1rem; }
    .reservation-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .reservation-card { background-color: white; padding: 12px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .reservation-card-header { font-weight: bold; margin-bottom: 8px; text-align: center; padding: 8px; border-radius: 3px; color: white; font-size: 0.9rem; }
    .reservation-card-header.today-breakfast { background-color: #f39c12; }
    .reservation-card-header.today-dinner { background-color: #e74c3c; }
    .reservation-card-header.tomorrow-breakfast { background-color: #3498db; }
    .reservation-card-header.tomorrow-dinner { background-color: #9b59b6; }
    .reservation-count { font-size: 1.3rem; font-weight: bold; text-align: center; margin: 10px 0; }
    .reservation-users { overflow-y: visible; max-height: none; }
    .reservation-users p { margin: 3px 0; font-size: 0.8rem; padding: 3px 6px; background-color: #f8f9fa; border-radius: 3px; }
    .no-reservations { text-align: center; color: #7f8c8d; font-style: italic; padding: 12px; font-size: 0.9rem; }
    .total-count { background-color: #3498db; color: white; padding: 2px 8px; border-radius: 3px; }
    
    /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ */
    @media (max-width: 1024px) {
      .container { padding: 12px; }
      .calendar { gap: 1px; }
      .calendar-cell { min-height: 90px; padding: 3px; }
      .meal-section { font-size: 0.7rem; }
      .menu-edit-area { padding: 15px; }
      .meal-edit-section { padding: 12px; }
    }
    
    /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ */
    @media (max-width: 768px) {
      body { padding: 5px; }
      .container { padding: 10px; }
      .admin-header { padding: 12px; margin: -10px -10px 15px -10px; }
      .admin-header h1 { font-size: 1.2rem; }
      .reservation-grid { grid-template-columns: 1fr; gap: 8px; }
      .month-navigation { flex-direction: column; gap: 8px; }
      .month-navigation button { min-width: 100px; padding: 8px 12px; }
      .calendar { grid-template-columns: repeat(7, 1fr); gap: 1px; }
      .calendar-cell { min-height: 80px; padding: 2px; }
      .weekday-header { padding: 6px 2px; font-size: 0.8rem; }
      .date-header { font-size: 0.8rem; }
      .meal-section { font-size: 0.65rem; }
      .meal-count { font-size: 0.6rem; padding: 1px 4px; }
      .menu-display { font-size: 0.6rem !important; }
      .summary-title { font-size: 1rem; }
      .reservation-count { font-size: 1.1rem; }
      .reservation-users p { font-size: 0.75rem; }
      .menu-edit-area { padding: 12px; }
      .menu-edit-date { font-size: 1rem; }
      .meal-edit-section { padding: 10px; }
      .meal-edit-title { font-size: 1rem; }
    }
    
    /* å°ã•ãªã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ */
    @media (max-width: 480px) {
      body { padding: 2px; }
      .container { padding: 8px; }
      .admin-header { padding: 10px; margin: -8px -8px 12px -8px; }
      .admin-header h1 { font-size: 1.1rem; }
      .month-navigation h3 { font-size: 1rem; }
      .calendar-cell { min-height: 70px; padding: 1px; }
      .weekday-header { padding: 4px 1px; font-size: 0.7rem; }
      .date-header { font-size: 0.7rem; }
      .meal-section { font-size: 0.6rem; }
      .meal-count { font-size: 0.55rem; }
      .menu-display { font-size: 0.55rem !important; }
      .reservation-users p { font-size: 0.7rem; padding: 2px 4px; }
      .menu-edit-area { padding: 10px; }
      .menu-edit-date { font-size: 0.9rem; }
      .meal-edit-section { padding: 8px; }
      .meal-edit-title { font-size: 0.9rem; }
      .menu-input-section { flex-direction: column; gap: 8px; }
    }
    
    /* æ¨ªå‘ãã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ */
    @media (max-width: 768px) and (orientation: landscape) {
      .reservation-grid { grid-template-columns: repeat(2, 1fr); }
      .month-navigation { flex-direction: row; }
      .calendar-cell { min-height: 80px; }
    }
    
    /* ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ç”¨ã®ãƒœã‚¿ãƒ³èª¿æ•´ */
    @media (pointer: coarse) {
      .menu-update-btn, .recruitment-toggle-btn { min-height: 40px; min-width: 80px; }
      select, input { min-height: 40px; }
      .month-navigation button { min-height: 40px; }
      .calendar-cell { min-height: 90px; }
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <div class="admin-header">
      <h1>æœå¤•é£Ÿäºˆç´„ã‚·ã‚¹ãƒ†ãƒ </h1>
      <span class="admin-badge">ç®¡ç†è€…ç”»é¢</span>
    </div>

    <div class="form-group" v-if="loading">
      <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div v-else>
      <div class="month-navigation">
        <button @click="prevMonth" :disabled="calendarLoading || menuUpdateLoading || recruitmentToggleLoading">&laquo; å‰æœˆ</button>
        <h3>{{ currentYear }}å¹´ {{ currentMonth }}æœˆ</h3>
        <button @click="nextMonth" :disabled="calendarLoading || menuUpdateLoading || recruitmentToggleLoading">æ¬¡æœˆ &raquo;</button>
        <button @click="openMealSheet" :disabled="sheetOpenLoading || calendarLoading">
          <span v-if="sheetOpenLoading">å‡¦ç†ä¸­...</span>
          <span v-else>é£Ÿäº‹åŸç´™ã‚’ç¢ºèª</span>
        </button>
      </div>

      <div class="summary-section" v-if="isCurrentMonth">
        <div class="summary-title">
          {{ reservationStatusTitle }}
        </div>
        <div class="reservation-grid">
          <!-- ä»Šæ—¥ã®æœé£Ÿ -->
          <div class="reservation-card">
            <div class="reservation-card-header today-breakfast">
              {{ todayDateJapanese }}æœé£Ÿ
            </div>
            <div class="reservation-count">
              {{ todayBreakfastCount }}é£Ÿ
            </div>
            <div v-if="todayBreakfastCount > 0" class="reservation-users">
              <p v-for="(user, idx) in todayBreakfastUsers" :key="'today-b-' + idx">
                {{ user.userId }}å·å®¤ - {{ user.userName }}
              </p>
            </div>
            <div v-else class="no-reservations">
              äºˆç´„ãªã—
            </div>
          </div>

          <!-- ä»Šæ—¥ã®å¤•é£Ÿ -->
          <div class="reservation-card">
            <div class="reservation-card-header today-dinner">
              {{ todayDateJapanese }}å¤•é£Ÿ
            </div>
            <div class="reservation-count">
              {{ todayDinnerCount }}é£Ÿ
            </div>
            <div v-if="todayDinnerCount > 0" class="reservation-users">
              <p v-for="(user, idx) in todayDinnerUsers" :key="'today-d-' + idx">
                {{ user.userId }}å·å®¤ - {{ user.userName }}
              </p>
            </div>
            <div v-else class="no-reservations">
              äºˆç´„ãªã—
            </div>
          </div>

          <!-- æ˜æ—¥ã®æœé£Ÿ -->
          <div class="reservation-card">
            <div class="reservation-card-header tomorrow-breakfast">
              {{ tomorrowDateJapanese }}æœé£Ÿ
            </div>
            <div class="reservation-count">
              {{ tomorrowBreakfastCount }}é£Ÿ
            </div>
            <div v-if="tomorrowBreakfastCount > 0" class="reservation-users">
              <p v-for="(user, idx) in tomorrowBreakfastUsers" :key="'tomorrow-b-' + idx">
                {{ user.userId }}å·å®¤ - {{ user.userName }}
              </p>
            </div>
            <div v-else class="no-reservations">
              äºˆç´„ãªã—
            </div>
          </div>

          <!-- æ˜æ—¥ã®å¤•é£Ÿ -->
          <div class="reservation-card">
            <div class="reservation-card-header tomorrow-dinner">
              {{ tomorrowDateJapanese }}å¤•é£Ÿ
            </div>
            <div v-if="!isTomorrowSaturday" class="reservation-count">
              {{ tomorrowDinnerCount }}é£Ÿ
            </div>
            <div v-if="!isTomorrowSaturday && tomorrowDinnerCount > 0" class="reservation-users">
              <p v-for="(user, idx) in tomorrowDinnerUsers" :key="'tomorrow-d-' + idx">
                {{ user.userId }}å·å®¤ - {{ user.userName }}
              </p>
            </div>
            <div v-if="!isTomorrowSaturday && tomorrowDinnerCount === 0" class="no-reservations">
              äºˆç´„ãªã—
            </div>
            <div v-if="isTomorrowSaturday" class="no-reservations">
              åœŸæ›œæ—¥ã®ãŸã‚æä¾›ãªã—
            </div>
          </div>
        </div>
      </div>

      <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ã‚¨ãƒªã‚¢ -->
      <div v-if="selectedDate" class="menu-edit-area">
        <div class="menu-edit-header">
          <div class="menu-edit-date">{{ formatDateJapanese(new Date(selectedDate)) }} ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†</div>
          <button class="menu-edit-close" @click="closeMenuEdit">&times;</button>
        </div>
        
        <!-- æœé£Ÿç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div v-if="getBreakfastForDate(selectedDate)" class="meal-edit-section">
          <div class="meal-edit-title">ğŸŒ… æœé£Ÿ ({{ getBreakfastForDate(selectedDate).count }}é£Ÿ)</div>
          
          <div v-if="!isRecruitmentStopped(selectedDate, 'breakfast')">
            <div class="current-menu">
              <div class="current-menu-label">ç¾åœ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼:</div>
              <div class="current-menu-text">
                {{ getBreakfastForDate(selectedDate).menuName || 'æœªè¨­å®š' }}
                <span v-if="getBreakfastForDate(selectedDate).menuName && getBreakfastForDate(selectedDate).menuName !== 'æœªè¨­å®š' && getBreakfastForDate(selectedDate).calorie" class="current-calorie">
                  ({{ getBreakfastForDate(selectedDate).calorie }}kcal)
                </span>
              </div>
            </div>
            
            <div class="menu-input-section">
              <div class="autocomplete-container">
                <label>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å…¥åŠ›:</label>
                <input type="text" 
                       v-model="editBreakfastMenu" 
                       @input="onBreakfastMenuInput"
                       @keydown="onBreakfastKeydown"
                       @blur="hideBreakfastSuggestions"
                       @focus="showBreakfastSuggestions"
                       placeholder="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆé ­æ–‡å­—ã§äºˆæ¸¬è¡¨ç¤ºï¼‰"
                       autocomplete="off">
                <div v-if="showBreakfastSuggestionsList && filteredBreakfastMenus.length > 0" 
                     class="autocomplete-suggestions">
                  <div v-for="(menu, index) in filteredBreakfastMenus" 
                       :key="menu.name" 
                       class="autocomplete-suggestion"
                       :class="{ selected: breakfastSelectedIndex === index }"
                       @mousedown="selectBreakfastMenu(menu)"
                       @mouseenter="breakfastSelectedIndex = index">
                    {{ menu.name }} <span class="menu-calorie">({{ menu.calorie }}kcal)</span>
                  </div>
                </div>
              </div>
              <div class="calorie-input-container">
                <label>ã‚«ãƒ­ãƒªãƒ¼:</label>
                <input type="number" 
                       v-model.number="editBreakfastCalorie"
                       placeholder="0"
                       min="0"
                       max="9999">
                <span class="calorie-unit">kcal</span>
              </div>
              <button class="menu-update-btn" @click="updateSelectedMenu('breakfast')" :disabled="menuUpdateLoading">
                <span v-if="menuUpdateLoading">æ›´æ–°ä¸­...</span>
                <span v-else>ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°</span>
              </button>
            </div>
          </div>
          <div v-else class="meal-unavailable">ã“ã®æ—¥ã®æœé£Ÿã¯ä¼‘æ­¢ä¸­ã§ã™</div>
          
          <div class="recruitment-toggle-section">
            <button class="recruitment-toggle-btn" 
                    :class="{ 'stopped': isRecruitmentStopped(selectedDate, 'breakfast') }"
                    @click="toggleSelectedRecruitmentStop('breakfast')" 
                    :disabled="recruitmentToggleLoading">
              <span v-if="recruitmentToggleLoading">å‡¦ç†ä¸­...</span>
              <span v-else>{{ isRecruitmentStopped(selectedDate, 'breakfast') ? 'æœé£Ÿã®ä¼‘æ­¢ã‚’è§£é™¤ã™ã‚‹' : 'æœé£Ÿã‚’ä¼‘æ­¢ã™ã‚‹' }}</span>
            </button>
          </div>
        </div>
        <div v-else class="meal-edit-section">
          <div class="meal-unavailable">ã“ã®æ—¥ã¯æœé£Ÿã®æä¾›ãŒã‚ã‚Šã¾ã›ã‚“</div>
        </div>

        <!-- å¤•é£Ÿç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div v-if="getDinnerForDate(selectedDate) && !isSaturday(selectedDate)" class="meal-edit-section dinner">
          <div class="meal-edit-title">ğŸŒ† å¤•é£Ÿ ({{ getDinnerForDate(selectedDate).count }}é£Ÿ)</div>
          
          <div v-if="!isRecruitmentStopped(selectedDate, 'dinner')">
            <div class="current-menu">
              <div class="current-menu-label">ç¾åœ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼:</div>
              <div class="current-menu-text">
                {{ getDinnerForDate(selectedDate).menuName || 'æœªè¨­å®š' }}
                <span v-if="getDinnerForDate(selectedDate).menuName && getDinnerForDate(selectedDate).menuName !== 'æœªè¨­å®š' && getDinnerForDate(selectedDate).calorie" class="current-calorie">
                  ({{ getDinnerForDate(selectedDate).calorie }}kcal)
                </span>
              </div>
            </div>
            
            <div class="menu-input-section">
              <div class="autocomplete-container">
                <label>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å…¥åŠ›:</label>
                <input type="text" 
                       v-model="editDinnerMenu" 
                       @input="onDinnerMenuInput"
                       @keydown="onDinnerKeydown"
                       @blur="hideDinnerSuggestions"
                       @focus="showDinnerSuggestions"
                       placeholder="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆé ­æ–‡å­—ã§äºˆæ¸¬è¡¨ç¤ºï¼‰"
                       autocomplete="off">
                <div v-if="showDinnerSuggestionsList && filteredDinnerMenus.length > 0" 
                     class="autocomplete-suggestions">
                  <div v-for="(menu, index) in filteredDinnerMenus" 
                       :key="menu.name" 
                       class="autocomplete-suggestion"
                       :class="{ selected: dinnerSelectedIndex === index }"
                       @mousedown="selectDinnerMenu(menu)"
                       @mouseenter="dinnerSelectedIndex = index">
                    {{ menu.name }} <span class="menu-calorie">({{ menu.calorie }}kcal)</span>
                  </div>
                </div>
              </div>
              <div class="calorie-input-container">
                <label>ã‚«ãƒ­ãƒªãƒ¼:</label>
                <input type="number" 
                       v-model.number="editDinnerCalorie"
                       placeholder="0"
                       min="0"
                       max="9999">
                <span class="calorie-unit">kcal</span>
              </div>
              <button class="menu-update-btn" @click="updateSelectedMenu('dinner')" :disabled="menuUpdateLoading">
                <span v-if="menuUpdateLoading">æ›´æ–°ä¸­...</span>
                <span v-else>ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°</span>
              </button>
            </div>
          </div>
          <div v-else class="meal-unavailable">ã“ã®æ—¥ã®å¤•é£Ÿã¯ä¼‘æ­¢ä¸­ã§ã™</div>
          
          <div class="recruitment-toggle-section">
            <button class="recruitment-toggle-btn" 
                    :class="{ 'stopped': isRecruitmentStopped(selectedDate, 'dinner') }"
                    @click="toggleSelectedRecruitmentStop('dinner')" 
                    :disabled="recruitmentToggleLoading">
              <span v-if="recruitmentToggleLoading">å‡¦ç†ä¸­...</span>
              <span v-else>{{ isRecruitmentStopped(selectedDate, 'dinner') ? 'å¤•é£Ÿã®ä¼‘æ­¢ã‚’è§£é™¤ã™ã‚‹' : 'å¤•é£Ÿã‚’ä¼‘æ­¢ã™ã‚‹' }}</span>
            </button>
          </div>
        </div>
        <div v-else-if="isSaturday(selectedDate)" class="meal-edit-section dinner">
          <div class="meal-unavailable">åœŸæ›œæ—¥ã¯å¤•é£Ÿã®æä¾›ãŒã‚ã‚Šã¾ã›ã‚“</div>
        </div>
        <div v-else class="meal-edit-section dinner">
          <div class="meal-unavailable">ã“ã®æ—¥ã¯å¤•é£Ÿã®æä¾›ãŒã‚ã‚Šã¾ã›ã‚“</div>
        </div>
      </div>

      <div class="calendar-container" v-if="calendarLoaded">
        <div class="calendar">
          <div v-for="(day, index) in weekdays" :key="index" class="weekday-header">{{ day }}</div>
        </div>
        <div class="calendar" style="margin-top: 1px;">
          <div v-for="i in offset" :key="'empty-' + i" class="calendar-cell empty-cell"></div>
          <div v-for="date in monthDates" :key="date" 
               class="calendar-cell" 
               :class="{ 'today': isToday(date), 'selected': selectedDate === date }"
               @click="selectDate(date)">
            <div class="date-header">{{ getDayFromDate(date) }}</div>
            <div class="meal-section">
              <div v-if="getBreakfastForDate(date)" class="meal-item">
                <div class="meal-title">
                  <strong>æœé£Ÿ</strong>
                  <span class="meal-count">{{ getBreakfastForDate(date).count }}é£Ÿ</span>
                </div>
                <div class="menu-display" v-if="!isRecruitmentStopped(date, 'breakfast')">
                  {{ getBreakfastForDate(date).menuName || 'æœªè¨­å®š' }}
                  <div v-if="getBreakfastForDate(date).menuName && getBreakfastForDate(date).menuName !== 'æœªè¨­å®š' && getBreakfastForDate(date).calorie" class="calorie-info">
                    ({{ getBreakfastForDate(date).calorie }}kcal)
                  </div>
                </div>
                <div v-if="isRecruitmentStopped(date, 'breakfast')" class="meal-unavailable">ä¼‘æ­¢ä¸­</div>
              </div>
              <div v-else class="meal-item">
                <div class="meal-title">
                  <strong>æœé£Ÿ</strong>
                  <span class="unavailable">âœ—</span>
                </div>
              </div>

              <hr />

              <div v-if="getDinnerForDate(date) && !isSaturday(date)" class="meal-item">
                <div class="meal-title">
                  <strong>å¤•é£Ÿ</strong>
                  <span class="meal-count">{{ getDinnerForDate(date).count }}é£Ÿ</span>
                </div>
                <div class="menu-display" v-if="!isRecruitmentStopped(date, 'dinner')">
                  {{ getDinnerForDate(date).menuName || 'æœªè¨­å®š' }}
                  <div v-if="getDinnerForDate(date).menuName && getDinnerForDate(date).menuName !== 'æœªè¨­å®š' && getDinnerForDate(date).calorie" class="calorie-info">
                    ({{ getDinnerForDate(date).calorie }}kcal)
                  </div>
                </div>
                <div v-if="isRecruitmentStopped(date, 'dinner')" class="meal-unavailable">ä¼‘æ­¢ä¸­</div>
              </div>
              <div v-else-if="isSaturday(date)" class="meal-item">
                <div class="meal-title">
                  <strong>å¤•é£Ÿ</strong>
                  <span class="unavailable">âœ—</span>
                </div>
              </div>
              <div v-else class="meal-item">
                <div class="meal-title">
                  <strong>å¤•é£Ÿ</strong>
                  <span class="unavailable">âœ—</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div v-else-if="calendarLoading" class="loading">
        ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
      </div>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        loading: true,
        currentYear: new Date().getFullYear(),
        currentMonth: new Date().getMonth() + 1,
        calendarLoading: false,
        calendarLoaded: false,
        weekdays: ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'],
        offset: 0,
        monthDates: [],
        breakfastReservations: [],
        dinnerReservations: [],
        breakfastMenuInputs: {},
        dinnerMenuInputs: {},
        breakfastMenuList: [],
        dinnerMenuList: [],
        recruitmentStops: {}, // å‹Ÿé›†åœæ­¢æƒ…å ±ã‚’æ ¼ç´
        menuUpdateLoading: false, // ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°ä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
        recruitmentToggleLoading: false, // å‹Ÿé›†åœæ­¢åˆ‡ã‚Šæ›¿ãˆä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
        sheetOpenLoading: false, // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé–‹ãå‡¦ç†ä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
        selectedDate: null, // é¸æŠã•ã‚ŒãŸæ—¥ä»˜
        editBreakfastMenu: '', // ç·¨é›†ä¸­ã®æœé£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼
        editDinnerMenu: '', // ç·¨é›†ä¸­ã®å¤•é£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼
        editBreakfastCalorie: 0, // ç·¨é›†ä¸­ã®æœé£Ÿã‚«ãƒ­ãƒªãƒ¼
        editDinnerCalorie: 0, // ç·¨é›†ä¸­ã®å¤•é£Ÿã‚«ãƒ­ãƒªãƒ¼
        // Autocomplete functionality
        showBreakfastSuggestionsList: false, // æœé£Ÿã®äºˆæ¸¬å€™è£œãƒªã‚¹ãƒˆè¡¨ç¤ºãƒ•ãƒ©ã‚°
        showDinnerSuggestionsList: false, // å¤•é£Ÿã®äºˆæ¸¬å€™è£œãƒªã‚¹ãƒˆè¡¨ç¤ºãƒ•ãƒ©ã‚°
        filteredBreakfastMenus: [], // ãƒ•ã‚£ãƒ«ã‚¿ã•ã‚ŒãŸæœé£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆ
        filteredDinnerMenus: [], // ãƒ•ã‚£ãƒ«ã‚¿ã•ã‚ŒãŸå¤•é£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆ
        breakfastSelectedIndex: -1, // æœé£Ÿã®é¸æŠä¸­ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
        dinnerSelectedIndex: -1 // å¤•é£Ÿã®é¸æŠä¸­ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
      },
      computed: {
        isCurrentMonth: function() {
          const now = new Date();
          return this.currentYear === now.getFullYear() && this.currentMonth === now.getMonth() + 1;
        },
        todayBreakfastCount: function() {
          if (!this.isCurrentMonth) return 0;
          const today = new Date();
          const todayStr = this.formatDate(today);
          const breakfast = this.getBreakfastForDate(todayStr);
          return breakfast ? breakfast.count : 0;
        },
        todayDinnerCount: function() {
          if (!this.isCurrentMonth) return 0;
          const today = new Date();
          const todayStr = this.formatDate(today);
          const dinner = this.getDinnerForDate(todayStr);
          return dinner ? dinner.count : 0;
        },
        todayBreakfastUsers: function() {
          if (!this.isCurrentMonth) return [];
          const today = new Date();
          const todayStr = this.formatDate(today);
          const breakfast = this.getBreakfastForDate(todayStr);
          return breakfast ? breakfast.users : [];
        },
        todayDinnerUsers: function() {
          if (!this.isCurrentMonth) return [];
          const today = new Date();
          const todayStr = this.formatDate(today);
          const dinner = this.getDinnerForDate(todayStr);
          return dinner ? dinner.users : [];
        },
        // æ˜æ—¥ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿
        tomorrowBreakfastCount: function() {
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          const tomorrowStr = this.formatDate(tomorrow);
          
          // æ˜æ—¥ãŒç¿Œæœˆã®å ´åˆã®å‡¦ç†
          if (tomorrow.getMonth() + 1 !== this.currentMonth || tomorrow.getFullYear() !== this.currentYear) {
            return 0;
          }
          
          const breakfast = this.getBreakfastForDate(tomorrowStr);
          return breakfast ? breakfast.count : 0;
        },
        tomorrowDinnerCount: function() {
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          const tomorrowStr = this.formatDate(tomorrow);
          
          // æ˜æ—¥ãŒç¿Œæœˆã®å ´åˆã®å‡¦ç†
          if (tomorrow.getMonth() + 1 !== this.currentMonth || tomorrow.getFullYear() !== this.currentYear) {
            return 0;
          }
          
          const dinner = this.getDinnerForDate(tomorrowStr);
          return dinner ? dinner.count : 0;
        },
        tomorrowBreakfastUsers: function() {
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          const tomorrowStr = this.formatDate(tomorrow);
          
          // æ˜æ—¥ãŒç¿Œæœˆã®å ´åˆã®å‡¦ç†
          if (tomorrow.getMonth() + 1 !== this.currentMonth || tomorrow.getFullYear() !== this.currentYear) {
            return [];
          }
          
          const breakfast = this.getBreakfastForDate(tomorrowStr);
          return breakfast ? breakfast.users : [];
        },
        tomorrowDinnerUsers: function() {
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          const tomorrowStr = this.formatDate(tomorrow);
          
          // æ˜æ—¥ãŒç¿Œæœˆã®å ´åˆã®å‡¦ç†
          if (tomorrow.getMonth() + 1 !== this.currentMonth || tomorrow.getFullYear() !== this.currentYear) {
            return [];
          }
          
          const dinner = this.getDinnerForDate(tomorrowStr);
          return dinner ? dinner.users : [];
        },
        // æ˜æ—¥ãŒåœŸæ›œæ—¥ã‹ã©ã†ã‹
        isTomorrowSaturday: function() {
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          return tomorrow.getDay() === 6;
        },
        // ä»Šæ—¥ã®æ—¥ä»˜ï¼ˆæ—¥æœ¬èªè¡¨ç¤ºï¼‰
        todayDateJapanese: function() {
          const today = new Date();
          return this.formatDateJapanese(today);
        },
        // æ˜æ—¥ã®æ—¥ä»˜ï¼ˆæ—¥æœ¬èªè¡¨ç¤ºï¼‰
        tomorrowDateJapanese: function() {
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          return this.formatDateJapanese(tomorrow);
        },
        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ç”¨ã®æ—¥ä»˜ç¯„å›²
        reservationStatusTitle: function() {
          return `${this.todayDateJapanese}ãƒ»${this.tomorrowDateJapanese}ã®äºˆç´„çŠ¶æ³`;
        }
      },
      methods: {
        loadCalendarData: function() {
          this.calendarLoading = true;
          this.calendarLoaded = false;
          this.fetchMenuLists();
          this.fetchRecruitmentStops();
          google.script.run
            .withSuccessHandler(this.processCalendarData)
            .withFailureHandler(this.handleCalendarError)
            .getMonthlyReservationCounts(this.currentYear, this.currentMonth);
        },
        fetchRecruitmentStops: function() {
          google.script.run
            .withSuccessHandler(response => {
              if (response.success) {
                this.recruitmentStops = response.stops;
              }
            })
            .withFailureHandler(this.handleError)
            .getRecruitmentStops(this.currentYear, this.currentMonth);
        },
        fetchMenuLists: function() {
          google.script.run
            .withSuccessHandler(this.processMenuLists)
            .withFailureHandler(this.handleError)
            .getMenuLists();
        },
        processMenuLists: function(data) {
          if (data.success) {
            this.breakfastMenuList = data.breakfast;
            this.dinnerMenuList = data.dinner;
          } else {
            console.error('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', data.message);
          }
        },
        processCalendarData: function(data) {
          console.log('âœ… processCalendarDataé–‹å§‹:', data);
          
          if (data && data.success) {
            this.createMonthDates();
            
            // é…åˆ—ã®å­˜åœ¨ç¢ºèªã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
            this.breakfastReservations = Array.isArray(data.breakfast) ? data.breakfast : [];
            this.dinnerReservations = Array.isArray(data.dinner) ? data.dinner : [];
            
            console.log('äºˆç´„ãƒ‡ãƒ¼ã‚¿è¨­å®šå®Œäº†:', {
              breakfastCount: this.breakfastReservations.length,
              dinnerCount: this.dinnerReservations.length
            });
            
            this.initializeMenuInputs();
            this.calendarLoaded = true;
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«é©åˆ‡ãªæ—¥ä»˜ã‚’é¸æŠ
            this.setInitialSelectedDate();
          } else {
            const errorMessage = data && data.message ? data.message : 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
            console.error('âŒ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¨ãƒ©ãƒ¼:', errorMessage);
            alert(errorMessage);
            this.calendarLoaded = false;
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
            this.breakfastReservations = [];
            this.dinnerReservations = [];
          }
          this.loading = false;
          this.calendarLoading = false;
        },
        initializeMenuInputs: function() {
          console.log('âœ… initializeMenuInputsé–‹å§‹');
          
          this.breakfastMenuInputs = {};
          if (Array.isArray(this.breakfastReservations)) {
            for (const item of this.breakfastReservations) {
              if (item && item.calendarId) {
                this.$set(this.breakfastMenuInputs, item.calendarId, item.menuName !== "æœªè¨­å®š" ? item.menuName : "");
              }
            }
          } else {
            console.warn('âš ï¸ breakfastReservations is not an array:', this.breakfastReservations);
          }
          
          this.dinnerMenuInputs = {};
          if (Array.isArray(this.dinnerReservations)) {
            for (const item of this.dinnerReservations) {
              if (item && item.calendarId) {
                this.$set(this.dinnerMenuInputs, item.calendarId, item.menuName !== "æœªè¨­å®š" ? item.menuName : "");
              }
            }
          } else {
            console.warn('âš ï¸ dinnerReservations is not an array:', this.dinnerReservations);
          }
          
          console.log('ãƒ¡ãƒ‹ãƒ¥ãƒ¼å…¥åŠ›åˆæœŸåŒ–å®Œäº†:', {
            breakfastInputs: Object.keys(this.breakfastMenuInputs).length,
            dinnerInputs: Object.keys(this.dinnerMenuInputs).length
          });
        },
        updateMenu: function(mealType, calendarId) {
          const menuInput = mealType === 'breakfast' ? this.breakfastMenuInputs[calendarId] : this.dinnerMenuInputs[calendarId];
          if (!menuInput || menuInput.trim() === '') {
            alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          
          this.menuUpdateLoading = true;
          google.script.run
            .withSuccessHandler(response => {
              this.handleMenuUpdateSuccess(response, mealType, calendarId, menuInput);
            })
            .withFailureHandler(this.handleError)
            .updateMenuForCalendar(calendarId, mealType, menuInput, this.currentYear, this.currentMonth);
        },
        handleMenuUpdateSuccess: function(response, mealType, calendarId, menuName) {
          if (response.success) {
            alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            const targetReservations = mealType === 'breakfast' ? this.breakfastReservations : this.dinnerReservations;
            const targetMenuList = mealType === 'breakfast' ? this.breakfastMenuList : this.dinnerMenuList;
            const index = targetReservations.findIndex(item => item.calendarId == calendarId);
            if (index !== -1) {
              targetReservations[index].menuName = menuName;
              targetReservations[index].menuId = response.menuId;
            }
            if (response.isNewMenu && !targetMenuList.includes(menuName)) {
              targetMenuList.push(menuName);
              targetMenuList.sort();
            }
          } else {
            alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + response.message);
          }
          this.menuUpdateLoading = false;
        },
        createMonthDates: function() {
          const daysInMonth = new Date(this.currentYear, this.currentMonth, 0).getDate();
          const firstDayOfMonth = new Date(this.currentYear, this.currentMonth - 1, 1);
          this.offset = firstDayOfMonth.getDay();
          this.monthDates = [];
          for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(this.currentYear, this.currentMonth - 1, day);
            this.monthDates.push(this.formatDate(date));
          }
        },
        formatDate: function(date) {
          const year = date.getFullYear();
          const month = (date.getMonth() + 1).toString().padStart(2, "0");
          const day = date.getDate().toString().padStart(2, "0");
          return `${year}-${month}-${day}`;
        },
        formatDateJapanese: function(date) {
          const month = date.getMonth() + 1;
          const day = date.getDate();
          return `${month}æœˆ${day}æ—¥`;
        },
        handleCalendarError: function(error) {
          console.error('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
          this.loading = false;
          this.calendarLoading = false;
          alert('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
        },
        handleError: function(error) {
          console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
          this.loading = false;
          this.calendarLoading = false;
          this.menuUpdateLoading = false;
          this.recruitmentToggleLoading = false;
          this.sheetOpenLoading = false;
          alert('å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚');
        },
        prevMonth: function() {
          if (this.currentMonth === 1) {
            this.currentYear--;
            this.currentMonth = 12;
          } else {
            this.currentMonth--;
          }
          // æœˆåˆ‡ã‚Šæ›¿ãˆæ™‚ã¯é¸æŠã‚’ã‚¯ãƒªã‚¢
          this.selectedDate = null;
          this.editBreakfastMenu = '';
          this.editDinnerMenu = '';
          this.editBreakfastCalorie = 0;
          this.editDinnerCalorie = 0;
          // Reset autocomplete states
          this.showBreakfastSuggestionsList = false;
          this.showDinnerSuggestionsList = false;
          this.breakfastSelectedIndex = -1;
          this.dinnerSelectedIndex = -1;
          this.loadCalendarData();
        },
        nextMonth: function() {
          if (this.currentMonth === 12) {
            this.currentYear++;
            this.currentMonth = 1;
          } else {
            this.currentMonth++;
          }
          // æœˆåˆ‡ã‚Šæ›¿ãˆæ™‚ã¯é¸æŠã‚’ã‚¯ãƒªã‚¢
          this.selectedDate = null;
          this.editBreakfastMenu = '';
          this.editDinnerMenu = '';
          this.editBreakfastCalorie = 0;
          this.editDinnerCalorie = 0;
          // Reset autocomplete states
          this.showBreakfastSuggestionsList = false;
          this.showDinnerSuggestionsList = false;
          this.breakfastSelectedIndex = -1;
          this.dinnerSelectedIndex = -1;
          this.loadCalendarData();
        },
        // --- â˜… ã“ã“ãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ãå‡¦ç† ---
        openMealSheet: function() {
          this.sheetOpenLoading = true;
          google.script.run
            .withSuccessHandler(response => {
              this.sheetOpenLoading = false;
              if (response.success) {
                window.open(response.url, '_blank');
              } else {
                alert('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + response.message);
              }
            })
            .withFailureHandler(error => {
              this.sheetOpenLoading = false;
              this.handleError(error);
            })
            .getMealSheetUrl();
        },
        // --- ã“ã“ã¾ã§ ---
        getBreakfastForDate: function(dateStr) {
          return this.breakfastReservations.find(item => item.date === dateStr);
        },
        getDinnerForDate: function(dateStr) {
          return this.dinnerReservations.find(item => item.date === dateStr);
        },
        getDayFromDate: function(dateStr) {
          return dateStr.split('-')[2].replace(/^0/, '');
        },
        isSaturday: function(dateStr) {
          return new Date(dateStr).getDay() === 6;
        },
        isSunday: function(dateStr) {
          return new Date(dateStr).getDay() === 0;
        },
        isToday: function(dateStr) {
          return dateStr === this.formatDate(new Date());
        },
        selectBreakfastMenu(calendarId) {
            // This is just to ensure reactivity, no specific action needed here
        },
        selectDinnerMenu(calendarId) {
            // Same as above
        },
        // å‹Ÿé›†åœæ­¢é–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰
        isRecruitmentStopped: function(date, mealType) {
          return this.recruitmentStops[date] && this.recruitmentStops[date][mealType];
        },
        toggleRecruitmentStop: function(date, mealType) {
          this.recruitmentToggleLoading = true;
          google.script.run
            .withSuccessHandler(response => {
              this.recruitmentToggleLoading = false;
              if (response.success) {
                alert(response.message);
                this.fetchRecruitmentStops();
              } else {
                alert('æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ: ' + response.message);
              }
            })
            .withFailureHandler(error => {
              this.recruitmentToggleLoading = false;
              this.handleError(error);
            })
            .toggleRecruitmentStop(date, mealType, this.currentYear, this.currentMonth);
        },
        // æ–°ã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ãƒ¡ã‚½ãƒƒãƒ‰
        selectDate: function(date) {
          this.selectedDate = date;
          this.updateEditMenus(date);
        },
        closeMenuEdit: function() {
          this.selectedDate = null;
          this.editBreakfastMenu = '';
          this.editDinnerMenu = '';
          // Reset autocomplete states
          this.showBreakfastSuggestionsList = false;
          this.showDinnerSuggestionsList = false;
          this.breakfastSelectedIndex = -1;
          this.dinnerSelectedIndex = -1;
        },
        // Autocomplete functionality for breakfast menu
        onBreakfastMenuInput: function() {
          this.filterBreakfastMenus();
          this.showBreakfastSuggestionsList = true;
          this.breakfastSelectedIndex = -1;
        },
        filterBreakfastMenus: function() {
          if (!this.editBreakfastMenu || this.editBreakfastMenu.trim() === '') {
            this.filteredBreakfastMenus = this.breakfastMenuList.slice(0, 10); // Show first 10 when empty
          } else {
            const searchTerm = this.editBreakfastMenu.toLowerCase().trim();
            this.filteredBreakfastMenus = this.breakfastMenuList.filter(menu => 
              menu.name.toLowerCase().includes(searchTerm)
            ).slice(0, 10); // Limit to 10 suggestions
          }
        },
        showBreakfastSuggestions: function() {
          // ç¾åœ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã€Œæœªè¨­å®šã€ã®å ´åˆã€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
          const breakfast = this.getBreakfastForDate(this.selectedDate);
          if (breakfast && breakfast.menuName === 'æœªè¨­å®š') {
            this.editBreakfastMenu = '';
            this.editBreakfastCalorie = 0;
          }
          this.filterBreakfastMenus();
          this.showBreakfastSuggestionsList = true;
        },
        hideBreakfastSuggestions: function() {
          // Add small delay to allow selection
          setTimeout(() => {
            this.showBreakfastSuggestionsList = false;
            this.breakfastSelectedIndex = -1;
          }, 150);
        },
        selectBreakfastMenu: function(menu) {
          this.editBreakfastMenu = menu.name;
          this.editBreakfastCalorie = menu.calorie;
          this.showBreakfastSuggestionsList = false;
          this.breakfastSelectedIndex = -1;
        },
        onBreakfastKeydown: function(event) {
          if (!this.showBreakfastSuggestionsList || this.filteredBreakfastMenus.length === 0) {
            return;
          }
          
          switch (event.key) {
            case 'ArrowDown':
              event.preventDefault();
              this.breakfastSelectedIndex = Math.min(this.breakfastSelectedIndex + 1, this.filteredBreakfastMenus.length - 1);
              break;
            case 'ArrowUp':
              event.preventDefault();
              this.breakfastSelectedIndex = Math.max(this.breakfastSelectedIndex - 1, -1);
              break;
            case 'Enter':
              event.preventDefault();
              if (this.breakfastSelectedIndex >= 0) {
                this.selectBreakfastMenu(this.filteredBreakfastMenus[this.breakfastSelectedIndex]);
              }
              break;
            case 'Escape':
              this.showBreakfastSuggestionsList = false;
              this.breakfastSelectedIndex = -1;
              break;
          }
        },
        
        // Autocomplete functionality for dinner menu
        onDinnerMenuInput: function() {
          this.filterDinnerMenus();
          this.showDinnerSuggestionsList = true;
          this.dinnerSelectedIndex = -1;
        },
        filterDinnerMenus: function() {
          if (!this.editDinnerMenu || this.editDinnerMenu.trim() === '') {
            this.filteredDinnerMenus = this.dinnerMenuList.slice(0, 10); // Show first 10 when empty
          } else {
            const searchTerm = this.editDinnerMenu.toLowerCase().trim();
            this.filteredDinnerMenus = this.dinnerMenuList.filter(menu => 
              menu.name.toLowerCase().includes(searchTerm)
            ).slice(0, 10); // Limit to 10 suggestions
          }
        },
        showDinnerSuggestions: function() {
          // ç¾åœ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã€Œæœªè¨­å®šã€ã®å ´åˆã€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
          const dinner = this.getDinnerForDate(this.selectedDate);
          if (dinner && dinner.menuName === 'æœªè¨­å®š') {
            this.editDinnerMenu = '';
            this.editDinnerCalorie = 0;
          }
          this.filterDinnerMenus();
          this.showDinnerSuggestionsList = true;
        },
        hideDinnerSuggestions: function() {
          // Add small delay to allow selection
          setTimeout(() => {
            this.showDinnerSuggestionsList = false;
            this.dinnerSelectedIndex = -1;
          }, 150);
        },
        selectDinnerMenu: function(menu) {
          this.editDinnerMenu = menu.name;
          this.editDinnerCalorie = menu.calorie;
          this.showDinnerSuggestionsList = false;
          this.dinnerSelectedIndex = -1;
        },
        onDinnerKeydown: function(event) {
          if (!this.showDinnerSuggestionsList || this.filteredDinnerMenus.length === 0) {
            return;
          }
          
          switch (event.key) {
            case 'ArrowDown':
              event.preventDefault();
              this.dinnerSelectedIndex = Math.min(this.dinnerSelectedIndex + 1, this.filteredDinnerMenus.length - 1);
              break;
            case 'ArrowUp':
              event.preventDefault();
              this.dinnerSelectedIndex = Math.max(this.dinnerSelectedIndex - 1, -1);
              break;
            case 'Enter':
              event.preventDefault();
              if (this.dinnerSelectedIndex >= 0) {
                this.selectDinnerMenu(this.filteredDinnerMenus[this.dinnerSelectedIndex]);
              }
              break;
            case 'Escape':
              this.showDinnerSuggestionsList = false;
              this.dinnerSelectedIndex = -1;
              break;
          }
        },
        updateSelectedMenu: function(mealType) {
          const breakfast = this.getBreakfastForDate(this.selectedDate);
          const dinner = this.getDinnerForDate(this.selectedDate);
          
          let calendarId;
          let menuInput;
          let calorieInput;
          
          if (mealType === 'breakfast' && breakfast) {
            calendarId = breakfast.calendarId;
            menuInput = this.editBreakfastMenu;
            calorieInput = this.editBreakfastCalorie;
          } else if (mealType === 'dinner' && dinner) {
            calendarId = dinner.calendarId;
            menuInput = this.editDinnerMenu;
            calorieInput = this.editDinnerCalorie;
          }
          
          if (!calendarId || !menuInput || menuInput.trim() === '') {
            alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          
          this.menuUpdateLoading = true;
          google.script.run
            .withSuccessHandler(response => {
              this.handleSelectedMenuUpdateSuccess(response, mealType, calendarId, menuInput, calorieInput);
            })
            .withFailureHandler(this.handleError)
            .updateMenuForCalendar(calendarId, mealType, menuInput, calorieInput, this.currentYear, this.currentMonth);
        },
        handleSelectedMenuUpdateSuccess: function(response, mealType, calendarId, menuName, calorieValue) {
          if (response.success) {
            alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            const targetReservations = mealType === 'breakfast' ? this.breakfastReservations : this.dinnerReservations;
            const targetMenuList = mealType === 'breakfast' ? this.breakfastMenuList : this.dinnerMenuList;
            const index = targetReservations.findIndex(item => item.calendarId == calendarId);
            if (index !== -1) {
              targetReservations[index].menuName = menuName;
              targetReservations[index].menuId = response.menuId;
              targetReservations[index].calorie = calorieValue || 0;
            }
            if (response.isNewMenu && !targetMenuList.some(m => m.name === menuName)) {
              targetMenuList.push({
                name: menuName,
                calorie: calorieValue || 0
              });
              targetMenuList.sort((a, b) => a.name.localeCompare(b.name));
            }
            // Reset autocomplete states
            if (mealType === 'breakfast') {
              this.showBreakfastSuggestionsList = false;
              this.breakfastSelectedIndex = -1;
            } else {
              this.showDinnerSuggestionsList = false;
              this.dinnerSelectedIndex = -1;
            }
          } else {
            alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + response.message);
          }
          this.menuUpdateLoading = false;
        },
        toggleSelectedRecruitmentStop: function(mealType) {
          if (!this.selectedDate) return;
          
          this.recruitmentToggleLoading = true;
          google.script.run
            .withSuccessHandler(response => {
              this.recruitmentToggleLoading = false;
              if (response.success) {
                alert(response.message);
                this.fetchRecruitmentStops();
              } else {
                alert('æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ: ' + response.message);
              }
            })
            .withFailureHandler(error => {
              this.recruitmentToggleLoading = false;
              this.handleError(error);
            })
            .toggleRecruitmentStop(this.selectedDate, mealType, this.currentYear, this.currentMonth);
        },
        // åˆæœŸé¸æŠæ—¥ä»˜ã‚’è¨­å®šã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
        setInitialSelectedDate: function() {
          const today = this.formatDate(new Date());
          
          // ä»Šæ—¥ã®æ—¥ä»˜ãŒç¾åœ¨è¡¨ç¤ºä¸­ã®æœˆã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ä»Šæ—¥ã‚’é¸æŠ
          if (this.monthDates && this.monthDates.includes(today)) {
            this.selectedDate = today;
            this.updateEditMenus(today);
          } else {
            // ä»Šæ—¥ãŒç¾åœ¨ã®æœˆã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ãã®æœˆã®æœ€åˆã®æ—¥ã‚’é¸æŠ
            if (this.monthDates && this.monthDates.length > 0) {
              this.selectedDate = this.monthDates[0];
              this.updateEditMenus(this.monthDates[0]);
            }
          }
        },
        // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼æƒ…å ±ã‚’ç·¨é›†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ›´æ–°
        updateEditMenus: function(date) {
          const breakfast = this.getBreakfastForDate(date);
          const dinner = this.getDinnerForDate(date);
          
          this.editBreakfastMenu = breakfast && breakfast.menuName !== 'æœªè¨­å®š' ? breakfast.menuName : '';
          this.editDinnerMenu = dinner && dinner.menuName !== 'æœªè¨­å®š' ? dinner.menuName : '';
          // Reset autocomplete states
          this.showBreakfastSuggestionsList = false;
          this.showDinnerSuggestionsList = false;
          this.breakfastSelectedIndex = -1;
          this.dinnerSelectedIndex = -1;
        },
      },
      mounted: function() {
        this.loadCalendarData();
      }
    });
  </script>
</body>
</html>